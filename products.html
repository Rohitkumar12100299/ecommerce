<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShopEase - Products</title>

  <!-- ================= GTM ================= -->
  <script>
    window.dataLayer = window.dataLayer || [];
  </script>

  <!-- PAGE VIEW + LOGIN STATE (HOMEPAGE JAISE) -->
  <script>
    (function () {
      const userId = localStorage.getItem("loggedInUser");

      dataLayer.push({
        event: "pageView",
        page_Name: "PLP",
        page_Type: "plp",
        site_Name: "ShopEase",
        language: "en-US",

        user_Id: userId ? userId : null,
        user_Type: userId ? "registered" : "guest"
        
      });
    })();
  </script>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];
  w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
  var f=d.getElementsByTagName(s)[0],j=d.createElement(s),
  dl=l!='dataLayer'?'&l='+l:'';
  j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
  f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-574TC2N4');</script>
  <!-- End GTM -->

  <!-- ================= STYLES (UNCHANGED) ================= -->
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
    body { background-color: #f9f9f9; }
    header { background:#333; color:#fff; padding:1rem; display:flex; justify-content:space-between; }
    nav ul { list-style:none; display:flex; }
    nav li { margin-left:1.5rem; }
    nav a { color:#fff; text-decoration:none; }
    .main-content { max-width:1200px; margin:auto; padding:2rem; }
    .products-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:1.5rem; }
    .product-card { background:#fff; border-radius:8px; cursor:pointer; overflow:hidden; }
    .product-card img { width:100%; height:200px; object-fit:cover; }
    .product-info { padding:1rem; }
  </style>
</head>

<body>

<header>
  <h1>ShopEase</h1>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="checkout.html">Cart</a></li>
    </ul>
  </nav>
</header>

<div class="main-content">
  <h1>Our Products</h1>
  <div class="products-grid" id="productsGrid"></div>
</div>

<script>
/* ================= PRODUCT DATA (UNCHANGED) ================= */
const products = [
  { id: 1, name: "Wireless Headphones", price: 59.99, category: "electronics", image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e" },
  { id: 2, name: "Smart Watch", price: 129.99, category: "electronics", image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30" },
  { id: 3, name: "Cotton T-Shirt", price: 19.99, category: "clothing", image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab" }
];

/* ================= PLP ITEM LIST (GA4 STANDARD) ================= */
(function () {
  const userId = localStorage.getItem("loggedInUser");

  const items = products.map((product, index) => ({
    item_id: "SKU_" + product.id,
    item_name: product.name,
    affiliation: "ShopEase",
    discount: 0,
    index: index,
    item_brand: "ShopEase",
    item_category: product.category,
    item_category2: null,
    item_category3: null,
    item_category4: null,
    item_category5: null,
    item_list_id: "plp_products",
    item_list_name: "ShopEase:Products",
    item_variant: null,
    location_id: null,
    price: product.price,
    google_business_vertical: "retail",
    quantity: 1
  }));

  dataLayer.push({
    event: "view_item_list",
   
   
    items: items
  });
})();

/* ================= RENDER PRODUCTS ================= */
function displayProducts() {
  const grid = document.getElementById("productsGrid");
  grid.innerHTML = "";

  products.forEach((product, index) => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
      <img src="${product.image}" alt="${product.name}">
      <div class="product-info">
        <h3>${product.name}</h3>
        <p>$${product.price}</p>
      </div>
    `;

    card.addEventListener("click", () => {
      const userId = localStorage.getItem("loggedInUser");

      /* GA4 SELECT ITEM */
      dataLayer.push({
        event: "select_item",
        
       
        items: [{
          item_id: "SKU_" + product.id,
          item_name: product.name,
          item_brand: "ShopEase",
          item_category: product.category,
          item_list_id: "plp_products",
          item_list_name: "ShopEase:Products",
          price: product.price,
          quantity: 1
        }]
      });

      /* EXISTING LINK CLICK */
      dataLayer.push({
        event: "linkClick",
        link_Text: product.name,
        link_Url: `product.html?id=${product.id}`
       
      });

      window.location.href = `product.html?id=${product.id}`;
    });

    grid.appendChild(card);
  });
}

displayProducts();
</script>

</body>
</html>
